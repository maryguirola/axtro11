<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <template id="payment_receipt_document">
            <t t-call="axtro_print.external_layout_no_signature">
                <t t-set="doc" t-value="doc.with_context({'lang':doc.partner_id.lang})"/>
                <div class="page">
                    <div class="oe_structure"/>

                    <div class="text-center">
                        <h4>
                            <t t-if="doc.payment_type == 'inbound'">
                                <br/><strong>PAYMENT RECEIPT: </strong>
                            </t>

                            <t t-if="doc.payment_type == 'outbound'">
                                <br/><strong>REMITTANCE ADVICE: </strong>
                            </t>

                            <span t-field="doc.name"/><br/><br/>
                        </h4>
                    </div>

                    <div class="row mt32 mb32">
                        <div class="col-xs-3">
                            <t t-if="doc.payment_type == 'inbound'">
                                <strong>Customer: </strong><br/>
                            </t>

                            <t t-if="doc.payment_type == 'outbound'">
                                <strong>Supplier: </strong><br/>
                            </t>

                            <span t-field="doc.partner_id"/>
                            <span t-field="doc.partner_id"
                                      t-field-options='{"widget": "contact", "fields": ["address"], "no_marker": true, "phone_icons": true}'/>

                        </div>
                        <div class="col-xs-3"/>
                        <div class="col-xs-3">
                            <strong>Payment Amount: </strong><br/>
                            <strong>Payment Method: </strong><br/>
                            <strong>Payment Date: </strong><br/>
                            <strong>Memo: </strong>
                        </div>

                        <div class="col-xs-3">
                            <span t-field="doc.amount" t-field-options='{"widget": "monetary", "display_currency": "doc.currency_id"}'/><br/>
                            <span t-field="doc.journal_id"/><br/>
                            <span t-esc="time.strftime('%d/%m/%Y', time.strptime(doc.payment_date,'%Y-%m-%d'))"/><br/>
                            <span t-field="doc.communication"/>
                        </div>
                    </div>

                    <!--<t t-set="invoices_total" t-value="0"/>-->
                    <!--<t t-set="residual_total" t-value="0"/>-->

                    <table class="table table-condensed">
                        <thead>
                            <tr>
                                <th><strong>Invoice No</strong></th>
                                <th><strong>Invoice Date</strong></th>
                                <t t-if="doc.payment_type == 'inbound'">
                                    <th> <strong>Customer PO</strong></th>
                                </t>
                                <t t-if="doc.payment_type == 'outbound'">
                                    <th> <strong>Vendor Ref</strong></th>
                                </t>
                                <th class="text-right"> <strong>Invoice Amount</strong></th>
                                <th class="text-right"> <strong>Amount Due</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="doc.invoice_ids" t-as="line">
                                <td>
                                    <span t-field="line.number"/>
                                </td>

                                <td>
                                    <span t-esc="time.strftime('%d/%m/%Y', time.strptime(line.date_invoice,'%Y-%m-%d'))"/>
                                </td>

                                <td>
                                    <t t-if="doc.payment_type == 'inbound'">
                                        <span t-field="line.jmd_po_number"/>
                                    </t>

                                    <t t-if="doc.payment_type == 'outbound'">
                                        <span t-field="line.reference"/>
                                    </t>

                                </td>

                                <td class="text-right">
                                    <span t-field="line.amount_total_signed"/>
                                </td>

                                <td class="text-right">
                                    <span t-field="line.residual"/>
                                    <!--<t t-set="residual_total" t-value="residual_total + line.residual"/>-->
                                </td>
                            </tr>

                            <tr class="border-black">
                                <td/>
                                <td/>
                                <td>
                                    <strong>Total</strong><br/>
                                    <strong>Payment</strong>
                                </td>
                                <td class="text-right">
                                    <!--<span t-esc="invoices_total"/><br/>-->
                                    <span t-field="doc.invoices_total" t-field-options='{"widget": "monetary", "display_currency": "doc.currency_id"}'/><br/>
                                    <span t-field="doc.amount" t-field-options='{"widget": "monetary", "display_currency": "doc.currency_id"}'/>
                                </td>
                                <td class="text-right">
                                    <!--<span t-esc="residual_total"/><br/>-->
                                    <span t-field="doc.residual_total" t-field-options='{"widget": "monetary", "display_currency": "doc.currency_id"}'/>
                                </td>
                            </tr>

                        </tbody>
                    </table>


                    <br/>
                    <br/>
                    <span>Invoice amount is the original invoiced amount</span><br/>
                    <span>Other payments related to these invoices are not detailed in this document</span><br/>
                    <span>The amount due reflects this payment and all other payments related to the same invoice</span>

                </div>
            </t>
        </template>

        <template id="payment_receipt">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="axtro_print.payment_receipt_document" t-lang="doc.partner_id.lang"/>
                </t>
            </t>
        </template>

        <report
            id="report_print_payment_receipt"
            string="Payment Receipt"
            model="account.payment"
            report_type="qweb-pdf"
            file="payment_receipt"
            name="axtro_print.payment_receipt"
        />

    </data>
</openerp>
